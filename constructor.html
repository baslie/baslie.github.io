<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Конструктор облицовочных материалов</title>
    <!-- Alpine.js подключение -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/intersect@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
    /* Изолированные стили с префиксом uc- */
    .uc-constructor {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .uc-constructor * {
        box-sizing: border-box;
    }

    /* Верхний блок с образцом и предпросмотром */
    .uc-constructor-header {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
        min-height: 400px;
    }

    /* Левая панель с образцом и характеристиками - ЕДИНЫЙ БЛОК */
    .uc-material-panel {
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 20px;
        transition: all 0.3s ease;
        position: relative;
    }

    .uc-material-panel:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    /* Образец материала внутри левой панели */
    .uc-material-sample {
        aspect-ratio: 2/1;
        border-radius: 8px;
        overflow: hidden;
        position: relative;
        background: #fff;
        border: 1px solid #dee2e6;
    }

    /* Правая панель с предпросмотром - ВЫСОКИЙ БЛОК */
    .uc-preview-panel {
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        overflow: hidden;
        position: relative;
        transition: all 0.3s ease;
        min-height: 100%;
        display: flex;
        flex-direction: column;
    }

    .uc-preview-panel:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .uc-sample-image,
    .uc-preview-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: opacity 0.3s ease;
    }

    .uc-preview-image {
        flex: 1;
    }

    .uc-sample-label,
    .uc-preview-label {
        position: absolute;
        top: 15px;
        left: 15px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        z-index: 2;
    }

    /* Блок характеристик внутри левой панели */
    .uc-material-info {
        background: #fff;
        border-radius: 8px;
        padding: 15px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        border: 1px solid #dee2e6;
    }

    .uc-info-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 4px 0;
        border-bottom: 1px solid #f1f3f4;
    }

    .uc-info-item:last-child {
        border-bottom: none;
    }

    .uc-info-label {
        font-size: 13px;
        color: #6c757d;
        font-weight: 500;
    }

    .uc-info-value {
        font-size: 13px;
        font-weight: 600;
        color: #212529;
        text-align: right;
    }

    /* Навигационные вкладки */
    .uc-tabs {
        display: flex;
        margin-bottom: 30px;
        background: #f8f9fa;
        border-radius: 8px;
        padding: 4px;
        gap: 4px;
    }

    .uc-tab-button {
        flex: 1;
        padding: 12px 16px;
        background: transparent;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        color: #6c757d;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .uc-tab-button:hover {
        background: rgba(0, 0, 0, 0.05);
        color: #495057;
    }

    .uc-tab-active {
        background: #fff !important;
        color: #212529 !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    /* Заголовок палитры */
    .uc-palette-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
    }

    .uc-palette-title {
        font-size: 18px;
        font-weight: 600;
        color: #212529;
    }

    .uc-materials-count {
        font-size: 14px;
        color: #6c757d;
        background: #f8f9fa;
        padding: 6px 12px;
        border-radius: 20px;
    }

    /* Палитра материалов */
    .uc-materials-grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 15px;
        margin-bottom: 20px;
    }

    .uc-material-item {
        aspect-ratio: 1;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        background: #fff;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        padding: 0;
    }

    .uc-material-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        border-color: #007bff;
    }

    .uc-material-selected {
        border-color: #007bff !important;
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25) !important;
        transform: translateY(-2px) !important;
    }

    .uc-material-thumb {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: opacity 0.3s ease;
    }

    .uc-loading-placeholder {
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: uc-shimmer 1.5s infinite;
    }

    @keyframes uc-shimmer {
        0% {
            background-position: -200% 0;
        }

        100% {
            background-position: 200% 0;
        }
    }

    /* Адаптивная верстка */
    @media (max-width: 1023px) {
        .uc-constructor-header {
            grid-template-columns: 1fr;
            gap: 20px;
            min-height: auto;
        }

        .uc-materials-grid {
            grid-template-columns: repeat(8, 1fr);
        }

        .uc-material-panel {
            order: 1;
        }

        .uc-preview-panel {
            order: 2;
            min-height: 300px;
        }
    }

    @media (max-width: 767px) {
        .uc-constructor {
            padding: 15px;
        }

        .uc-materials-grid {
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .uc-material-panel {
            padding: 15px;
            gap: 15px;
        }

        .uc-material-info {
            padding: 12px;
            gap: 6px;
        }

        .uc-tabs {
            flex-direction: column;
        }

        .uc-tab-button {
            text-align: center;
        }
    }

    @media (max-width: 480px) {
        .uc-materials-grid {
            grid-template-columns: repeat(3, 1fr);
        }

        .uc-palette-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }

        .uc-info-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 2px;
        }

        .uc-info-value {
            text-align: left;
        }
    }

    /* Анимации загрузки */
    .uc-fade-in {
        animation: uc-fadeIn 0.5s ease-in-out;
    }

    @keyframes uc-fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Состояние загрузки */
    .uc-loading {
        opacity: 0.6;
        pointer-events: none;
    }
    </style>
</head>

<body>
    <div id="uc-material-constructor" x-data="ucMaterialConstructor()" class="uc-constructor">
        <!-- Верхний блок: образец с характеристиками и предпросмотр -->
        <div class="uc-constructor-header">
            <!-- Левая панель: образец материала + характеристики (ЕДИНЫЙ БЛОК) -->
            <div class="uc-material-panel" :class="{ 'uc-loading': isLoading }">
                <div class="uc-material-sample">
                    <div class="uc-sample-label">Образец материала</div>
                    <img x-show="selectedMaterial" :src="materialSampleImage" :alt="selectedMaterial?.name || 'Материал'" class="uc-sample-image" x-transition.opacity.duration.300ms>
                    <div x-show="!selectedMaterial" class="uc-loading-placeholder"></div>
                </div>
                <!-- Характеристики материала -->
                <div x-show="selectedMaterial" class="uc-material-info uc-fade-in">
                    <div class="uc-info-item">
                        <span class="uc-info-label">Название:</span>
                        <span class="uc-info-value" x-text="selectedMaterial?.name || '—'"></span>
                    </div>
                    <div class="uc-info-item">
                        <span class="uc-info-label">Базовый цвет:</span>
                        <span class="uc-info-value" x-text="selectedMaterial?.baseColor || '—'"></span>
                    </div>
                    <div class="uc-info-item">
                        <span class="uc-info-label">Напыление:</span>
                        <span class="uc-info-value" x-text="selectedMaterial?.coating || '—'"></span>
                    </div>
                    <div class="uc-info-item">
                        <span class="uc-info-label">Рельеф:</span>
                        <span class="uc-info-value" x-text="selectedMaterial?.relief || '—'"></span>
                    </div>
                </div>
            </div>
            <!-- Правая панель: предпросмотр дома (ВЫСОКИЙ БЛОК) -->
            <div class="uc-preview-panel" :class="{ 'uc-loading': isLoading }">
                <div class="uc-preview-label">Предпросмотр на доме</div>
                <img x-show="selectedMaterial" :src="housePreviewImage" :alt="'Дом с материалом ' + (selectedMaterial?.name || '')" class="uc-preview-image" x-transition.opacity.duration.300ms>
                <div x-show="!selectedMaterial" class="uc-loading-placeholder"></div>
            </div>
        </div>
        <!-- Навигационные вкладки -->
        <nav class="uc-tabs">
            <template x-for="tab in tabs" :key="tab.id">
                <button @click="activeTab = tab.id; filterMaterials()" :class="{ 'uc-tab-active': activeTab === tab.id }" class="uc-tab-button" x-text="tab.label">
                </button>
            </template>
        </nav>
        <!-- Заголовок палитры -->
        <div class="uc-palette-header">
            <h3 class="uc-palette-title" x-text="currentTabLabel"></h3>
            <div class="uc-materials-count" x-text="filteredMaterials.length + ' материалов'"></div>
        </div>
        <!-- Палитра материалов -->
        <div class="uc-materials-grid">
            <template x-for="material in filteredMaterials" :key="material.id">
                <button @click="selectMaterial(material)" :class="{ 'uc-material-selected': selectedMaterial?.id === material.id }" class="uc-material-item" :title="material.name">
                    <img x-intersect.once="loadMaterialImage" :data-src="material.thumbnail" :alt="material.name" class="uc-material-thumb" loading="lazy">
                </button>
            </template>
        </div>
    </div>
    <script>
    // Безопасная функция для кодирования Unicode в base64
    function safeBase64Encode(str) {
        try {
            // Проверяем поддержку TextEncoder
            if (typeof TextEncoder !== 'undefined') {
                const bytes = new TextEncoder().encode(str);
                const binString = String.fromCodePoint(...bytes);
                return btoa(binString);
            } else {
                // Fallback для старых браузеров
                return btoa(unescape(encodeURIComponent(str)));
            }
        } catch (e) {
            console.warn('Error encoding string to base64:', e);
            // Возвращаем простую заглушку в случае ошибки
            return 'data:image/svg+xml;base64,' + btoa('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 100"><rect width="200" height="100" fill="#ccc"/></svg>');
        }
    }

    // Функция для создания SVG заглушек (ТОЛЬКО ASCII СИМВОЛЫ)
    function createBrickSVG(color1 = '#8B4513', color2 = '#A0522D', id = '') {
        const svgString = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 100">
        <defs>
            <pattern id="brick${id}" patternUnits="userSpaceOnUse" width="40" height="20">
                <rect width="40" height="20" fill="${color1}"/>
                <rect width="20" height="10" fill="${color2}"/>
                <rect x="20" y="10" width="20" height="10" fill="${color2}"/>
                <rect width="40" height="1" fill="#654321" opacity="0.3"/>
                <rect width="1" height="20" fill="#654321" opacity="0.3"/>
                <rect x="20" width="1" height="20" fill="#654321" opacity="0.3"/>
                <rect y="10" width="40" height="1" fill="#654321" opacity="0.3"/>
            </pattern>
        </defs>
        <rect width="200" height="100" fill="url(#brick${id})"/>
    </svg>`;

        return `data:image/svg+xml;base64,${safeBase64Encode(svgString)}`;
    }

    function createHouseSVG(roofColor = '#8B4513', wallColor = '#D2B48C') {
        const svgString = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300">
        <rect width="400" height="300" fill="#87CEEB"/>
        <rect y="250" width="400" height="50" fill="#90EE90"/>
        <rect x="100" y="150" width="200" height="100" fill="${wallColor}" stroke="#999" stroke-width="2"/>
        <polygon points="80,150 200,100 320,150" fill="${roofColor}" stroke="#654321" stroke-width="2"/>
        <rect x="180" y="200" width="40" height="50" fill="#8B4513" stroke="#654321" stroke-width="1"/>
        <circle cx="210" cy="225" r="2" fill="#FFD700"/>
        <rect x="120" y="170" width="30" height="25" fill="#87CEEB" stroke="#654321" stroke-width="1"/>
        <rect x="250" y="170" width="30" height="25" fill="#87CEEB" stroke="#654321" stroke-width="1"/>
        <line x1="135" y1="170" x2="135" y2="195" stroke="#654321" stroke-width="1"/>
        <line x1="120" y1="182.5" x2="150" y2="182.5" stroke="#654321" stroke-width="1"/>
        <line x1="265" y1="170" x2="265" y2="195" stroke="#654321" stroke-width="1"/>
        <line x1="250" y1="182.5" x2="280" y2="182.5" stroke="#654321" stroke-width="1"/>
        <rect x="240" y="110" width="15" height="30" fill="#696969" stroke="#555" stroke-width="1"/>
        <circle cx="250" cy="100" r="8" fill="#D3D3D3" opacity="0.7"/>
        <circle cx="245" cy="90" r="6" fill="#D3D3D3" opacity="0.5"/>
        <circle cx="255" cy="85" r="5" fill="#D3D3D3" opacity="0.3"/>
    </svg>`;

        return `data:image/svg+xml;base64,${safeBase64Encode(svgString)}`;
    }

    // Инициализация Alpine.js компонента
    document.addEventListener('alpine:init', () => {
        Alpine.data('ucMaterialConstructor', () => ({
            // Состояние приложения
            activeTab: 'facade',
            selectedMaterial: null,
            isLoading: false,

            // Вкладки
            tabs: [
                { id: 'facade', label: 'Фасад' },
                { id: 'basement', label: 'Цоколь' },
                { id: 'fence', label: 'Забор' }
            ],

            // Материалы (с SVG заглушками)
            materials: [
                // Фасадные материалы
                { id: 'GS1-T1-2', name: 'GS1-T1-2', baseColor: 'Красный', coating: 'Черное по диагонали', relief: 'Земля', category: 'facade', thumbnail: createBrickSVG('#8B4513', '#A0522D', '1') },
                { id: 'GS1-T1-3', name: 'GS1-T1-3', baseColor: 'Коричневый', coating: 'Матовое', relief: 'Гладкий', category: 'facade', thumbnail: createBrickSVG('#8B4513', '#CD853F', '2') },
                { id: 'GS1-T2-1', name: 'GS1-T2-1', baseColor: 'Серый', coating: 'Глянцевое', relief: 'Рифленый', category: 'facade', thumbnail: createBrickSVG('#696969', '#808080', '3') },
                { id: 'GS1-T2-2', name: 'GS1-T2-2', baseColor: 'Белый', coating: 'Полуматовое', relief: 'Земля', category: 'facade', thumbnail: createBrickSVG('#F5F5DC', '#FFFAF0', '4') },
                { id: 'GS1-T2-3', name: 'GS1-T2-3', baseColor: 'Желтый', coating: 'Сатин', relief: 'Кирпич', category: 'facade', thumbnail: createBrickSVG('#DAA520', '#F0E68C', '5') },
                { id: 'GS1-T3-1', name: 'GS1-T3-1', baseColor: 'Черный', coating: 'Глянец', relief: 'Камень', category: 'facade', thumbnail: createBrickSVG('#2F4F4F', '#696969', '6') },
                { id: 'GS1-T3-2', name: 'GS1-T3-2', baseColor: 'Зеленый', coating: 'Матовое', relief: 'Дерево', category: 'facade', thumbnail: createBrickSVG('#556B2F', '#6B8E23', '7') },
                { id: 'GS1-T3-3', name: 'GS1-T3-3', baseColor: 'Синий', coating: 'Полуглянец', relief: 'Плитка', category: 'facade', thumbnail: createBrickSVG('#4682B4', '#5F9EA0', '8') },
                { id: 'GS1-T4-1', name: 'GS1-T4-1', baseColor: 'Оранжевый', coating: 'Текстура', relief: 'Кора', category: 'facade', thumbnail: createBrickSVG('#FF8C00', '#FFA500', '9') },
                { id: 'GS1-T4-2', name: 'GS1-T4-2', baseColor: 'Фиолетовый', coating: 'Металлик', relief: 'Волна', category: 'facade', thumbnail: createBrickSVG('#8A2BE2', '#9370DB', '10') },
                { id: 'GS1-T4-3', name: 'GS1-T4-3', baseColor: 'Розовый', coating: 'Перламутр', relief: 'Мрамор', category: 'facade', thumbnail: createBrickSVG('#FFC0CB', '#FFB6C1', '11') },
                { id: 'GS1-T5-1', name: 'GS1-T5-1', baseColor: 'Бежевый', coating: 'Кракелюр', relief: 'Штукатурка', category: 'facade', thumbnail: createBrickSVG('#F5F5DC', '#D2B48C', '12') },

                // Цокольные материалы
                { id: 'BS1-C1-1', name: 'BS1-C1-1', baseColor: 'Серый', coating: 'Рустик', relief: 'Камень', category: 'basement', thumbnail: createBrickSVG('#708090', '#2F4F4F', 'b1') },
                { id: 'BS1-C1-2', name: 'BS1-C1-2', baseColor: 'Коричневый', coating: 'Антик', relief: 'Скала', category: 'basement', thumbnail: createBrickSVG('#8B4513', '#654321', 'b2') },
                { id: 'BS1-C2-1', name: 'BS1-C2-1', baseColor: 'Черный', coating: 'Гранит', relief: 'Полированный', category: 'basement', thumbnail: createBrickSVG('#2F2F2F', '#000000', 'b3') },
                { id: 'BS1-C2-2', name: 'BS1-C2-2', baseColor: 'Красный', coating: 'Клинкер', relief: 'Кирпич', category: 'basement', thumbnail: createBrickSVG('#B22222', '#8B0000', 'b4') },
                { id: 'BS1-C3-1', name: 'BS1-C3-1', baseColor: 'Бежевый', coating: 'Песчаник', relief: 'Природный', category: 'basement', thumbnail: createBrickSVG('#F5DEB3', '#DEB887', 'b5') },
                { id: 'BS1-C3-2', name: 'BS1-C3-2', baseColor: 'Зеленый', coating: 'Мох', relief: 'Старинный', category: 'basement', thumbnail: createBrickSVG('#9ACD32', '#556B2F', 'b6') },
                { id: 'BS1-C4-1', name: 'BS1-C4-1', baseColor: 'Синий', coating: 'Сланец', relief: 'Слоистый', category: 'basement', thumbnail: createBrickSVG('#4682B4', '#2F4F4F', 'b7') },
                { id: 'BS1-C4-2', name: 'BS1-C4-2', baseColor: 'Желтый', coating: 'Известняк', relief: 'Пористый', category: 'basement', thumbnail: createBrickSVG('#F0E68C', '#BDB76B', 'b8') },

                // Заборные материалы
                { id: 'FS1-F1-1', name: 'FS1-F1-1', baseColor: 'Коричневый', coating: 'Дерево', relief: 'Доска', category: 'fence', thumbnail: createBrickSVG('#8B4513', '#A0522D', 'f1') },
                { id: 'FS1-F1-2', name: 'FS1-F1-2', baseColor: 'Серый', coating: 'Металл', relief: 'Профлист', category: 'fence', thumbnail: createBrickSVG('#696969', '#C0C0C0', 'f2') },
                { id: 'FS1-F2-1', name: 'FS1-F2-1', baseColor: 'Зеленый', coating: 'Полимер', relief: 'Сетка', category: 'fence', thumbnail: createBrickSVG('#228B22', '#32CD32', 'f3') },
                { id: 'FS1-F2-2', name: 'FS1-F2-2', baseColor: 'Белый', coating: 'Штакетник', relief: 'Вертикальный', category: 'fence', thumbnail: createBrickSVG('#FFFFFF', '#F8F8FF', 'f4') },
                { id: 'FS1-F3-1', name: 'FS1-F3-1', baseColor: 'Черный', coating: 'Кованый', relief: 'Узорный', category: 'fence', thumbnail: createBrickSVG('#000000', '#2F2F2F', 'f5') },
                { id: 'FS1-F3-2', name: 'FS1-F3-2', baseColor: 'Красный', coating: 'Кирпич', relief: 'Блочный', category: 'fence', thumbnail: createBrickSVG('#DC143C', '#B22222', 'f6') },
                { id: 'FS1-F4-1', name: 'FS1-F4-1', baseColor: 'Бежевый', coating: 'Камень', relief: 'Булыжник', category: 'fence', thumbnail: createBrickSVG('#D2B48C', '#DEB887', 'f7') },
                { id: 'FS1-F4-2', name: 'FS1-F4-2', baseColor: 'Синий', coating: 'Пластик', relief: 'Сайдинг', category: 'fence', thumbnail: createBrickSVG('#4169E1', '#6495ED', 'f8') }
            ],

            filteredMaterials: [],

            // Инициализация компонента
            init() {
                this.filterMaterials();
                // Выбираем первый материал по умолчанию
                if (this.filteredMaterials.length > 0) {
                    this.selectedMaterial = this.filteredMaterials[0];
                }
            },

            // Вычисляемые свойства
            get currentTabLabel() {
                const tab = this.tabs.find(t => t.id === this.activeTab);
                return tab ? tab.label : '';
            },

            get materialSampleImage() {
                return this.selectedMaterial ? this.selectedMaterial.thumbnail : '';
            },

            get housePreviewImage() {
                if (!this.selectedMaterial) return '';

                // Создаем дом с цветом выбранного материала
                const colorMap = {
                    'Красный': '#8B4513',
                    'Коричневый': '#8B4513',
                    'Серый': '#696969',
                    'Белый': '#F5F5DC',
                    'Желтый': '#DAA520',
                    'Черный': '#2F4F4F',
                    'Зеленый': '#556B2F',
                    'Синий': '#4682B4',
                    'Оранжевый': '#FF8C00',
                    'Фиолетовый': '#8A2BE2',
                    'Розовый': '#FFC0CB',
                    'Бежевый': '#F5F5DC'
                };

                const wallColor = colorMap[this.selectedMaterial.baseColor] || '#D2B48C';
                return createHouseSVG('#8B4513', wallColor);
            },

            // Методы
            filterMaterials() {
                this.filteredMaterials = this.materials.filter(m => m.category === this.activeTab);

                // Если выбранный материал не подходит под фильтр, сбрасываем выбор
                if (this.selectedMaterial && this.selectedMaterial.category !== this.activeTab) {
                    this.selectedMaterial = this.filteredMaterials.length > 0 ? this.filteredMaterials[0] : null;
                }
            },

            selectMaterial(material) {
                this.isLoading = true;

                // Имитация загрузки
                setTimeout(() => {
                    this.selectedMaterial = material;
                    this.isLoading = false;

                    // Сохраняем выбор в localStorage
                    localStorage.setItem('uc-selected-material', JSON.stringify(material));
                }, 300);
            },

            loadMaterialImage() {
                const img = this.$el;
                const src = img.getAttribute('data-src');

                if (src && !img.src) {
                    img.src = src;
                    img.onload = () => {
                        img.style.opacity = '1';
                    };
                }
            }
        }));
    });

    // Загрузка сохраненного состояния при загрузке страницы
    document.addEventListener('DOMContentLoaded', () => {
        const saved = localStorage.getItem('uc-selected-material');
        if (saved) {
            try {
                const material = JSON.parse(saved);
                // Восстанавливаем состояние через событие
                setTimeout(() => {
                    const constructor = document.querySelector('#uc-material-constructor');
                    if (constructor && constructor._x_dataStack) {
                        const data = constructor._x_dataStack[0];
                        data.selectedMaterial = material;
                        data.activeTab = material.category;
                        data.filterMaterials();
                    }
                }, 100);
            } catch (e) {
                console.warn('Не удалось восстановить сохраненный материал');
            }
        }
    });
    </script>
</body>

</html>
