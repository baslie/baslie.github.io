<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Конструктор облицовочных материалов</title>
    <!-- Alpine.js подключение -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/intersect@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
    /* CSS ПЕРЕМЕННЫЕ - ЕДИНЫЙ БЛОК */
    :root {
        /* Цветовая палитра */
        --uc-primary-blue: #007bff;
        --uc-primary-blue-light: #1a73e8;
        --uc-primary-blue-bg: #e8f0fe;
        --uc-white: #fff;
        --uc-gray-50: #f8f9fa;
        --uc-gray-100: #f1f3f4;
        --uc-gray-200: #e9ecef;
        --uc-gray-300: #dee2e6;
        --uc-gray-400: #6c757d;
        --uc-gray-500: #5f6368;
        --uc-gray-600: #495057;
        --uc-gray-800: #212529;
        --uc-gray-900: #202124;
        --uc-black-overlay: rgba(0, 0, 0, 0.8);
        --uc-black-overlay-light: rgba(0, 0, 0, 0.7);
        
        /* Тени */
        --uc-shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.1);
        --uc-shadow-md: 0 4px 20px rgba(0, 0, 0, 0.1);
        --uc-shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.15);
        --uc-shadow-focus: 0 0 0 3px rgba(0, 123, 255, 0.25);
        --uc-shadow-tap: 0 2px 8px rgba(0, 0, 0, 0.2);
        
        /* Размеры и отступы */
        --uc-max-width: 1200px;
        --uc-border-radius: 12px;
        --uc-border-radius-sm: 6px;
        --uc-border-radius-md: 8px;
        --uc-border-radius-lg: 16px;
        --uc-border-radius-xl: 20px;
        --uc-border-width: 2px;
        --uc-border-width-thick: 3px;
        
        --uc-spacing-xs: 4px;
        --uc-spacing-sm: 8px;
        --uc-spacing-md: 12px;
        --uc-spacing-lg: 15px;
        --uc-spacing-xl: 20px;
        --uc-spacing-2xl: 30px;
        
        --uc-gap-sm: 10px;
        --uc-gap-md: 15px;
        --uc-gap-lg: 20px;
        --uc-gap-xl: 30px;
        
        /* Высоты и размеры элементов */
        --uc-min-height-sm: 280px;
        --uc-min-height-md: 300px;
        --uc-min-height-lg: 400px;
        --uc-min-touch-target: 48px;
        --uc-min-touch-target-lg: 52px;
        --uc-min-touch-target-xl: 56px;
        --uc-min-touch-target-2xl: 64px;
        
        /* Шрифты */
        --uc-font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        --uc-font-size-xs: 11px;
        --uc-font-size-sm: 12px;
        --uc-font-size-md: 13px;
        --uc-font-size-base: 14px;
        --uc-font-size-lg: 15px;
        --uc-font-size-xl: 18px;
        --uc-font-size-2xl: 20px;
        --uc-font-weight-normal: 500;
        --uc-font-weight-semibold: 600;
        --uc-font-weight-bold: 700;
        --uc-letter-spacing: 0.3px;
        --uc-letter-spacing-wide: 0.5px;
        
        /* Переходы и анимации */
        --uc-transition-fast: all 0.2s ease;
        --uc-transition-base: all 0.3s ease;
        --uc-transition-slow: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        --uc-animation-shimmer: uc-shimmer 1.5s infinite;
        --uc-animation-mobile-slide: uc-mobileSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        --uc-animation-fade: uc-fadeIn 0.5s ease-in-out;
        
        /* Темная тема */
        --uc-dark-bg: #1a1a1a;
        --uc-dark-surface: #2d2d2d;
        --uc-dark-surface-alt: #242424;
        --uc-dark-border: #404040;
        --uc-dark-text: #e8eaed;
        --uc-dark-text-secondary: #9aa0a6;
    }

    /* ОСНОВНЫЕ СТИЛИ */
    .uc-constructor {
        font-family: var(--uc-font-family);
        max-width: var(--uc-max-width);
        margin: 0 auto;
        padding: var(--uc-spacing-xl);
        background: var(--uc-white);
        border-radius: var(--uc-border-radius);
        box-shadow: var(--uc-shadow-md);
    }

    .uc-constructor * {
        box-sizing: border-box;
    }

    /* ВЕРХНИЙ БЛОК */
    .uc-constructor-header {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--uc-gap-xl);
        margin-bottom: var(--uc-gap-xl);
        min-height: var(--uc-min-height-lg);
    }

    /* ЛЕВАЯ ПАНЕЛЬ - МАТЕРИАЛ + ХАРАКТЕРИСТИКИ */
    .uc-material-panel {
        background: var(--uc-gray-50);
        border: var(--uc-border-width) solid var(--uc-gray-200);
        border-radius: var(--uc-border-radius);
        padding: var(--uc-spacing-xl);
        display: flex;
        flex-direction: column;
        gap: var(--uc-spacing-xl);
        transition: var(--uc-transition-base);
        position: relative;
    }

    .uc-material-panel:hover {
        transform: translateY(-2px);
        box-shadow: var(--uc-shadow-lg);
    }

    /* ПРАВАЯ ПАНЕЛЬ - ПРЕДПРОСМОТР */
    .uc-preview-panel {
        background: var(--uc-gray-50);
        border: var(--uc-border-width) solid var(--uc-gray-200);
        border-radius: var(--uc-border-radius);
        overflow: hidden;
        position: relative;
        transition: var(--uc-transition-base);
        min-height: 100%;
        display: flex;
        flex-direction: column;
    }

    .uc-preview-panel:hover {
        transform: translateY(-2px);
        box-shadow: var(--uc-shadow-lg);
    }

    /* ОБРАЗЕЦ МАТЕРИАЛА */
    .uc-material-sample {
        aspect-ratio: 2/1;
        border-radius: var(--uc-border-radius-md);
        overflow: hidden;
        position: relative;
        background: var(--uc-white);
        border: 1px solid var(--uc-gray-300);
    }

    .uc-sample-image,
    .uc-preview-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: var(--uc-transition-base);
    }

    .uc-preview-image {
        flex: 1;
    }

    .uc-sample-label,
    .uc-preview-label {
        position: absolute;
        top: var(--uc-spacing-lg);
        left: var(--uc-spacing-lg);
        background: var(--uc-black-overlay);
        color: var(--uc-white);
        padding: var(--uc-spacing-sm) var(--uc-spacing-md);
        border-radius: var(--uc-border-radius-sm);
        font-size: var(--uc-font-size-base);
        font-weight: var(--uc-font-weight-normal);
        z-index: 2;
    }

    /* ХАРАКТЕРИСТИКИ МАТЕРИАЛА */
    .uc-material-info {
        background: var(--uc-white);
        border-radius: var(--uc-border-radius-md);
        padding: var(--uc-spacing-lg);
        display: flex;
        flex-direction: column;
        gap: var(--uc-spacing-sm);
        border: 1px solid var(--uc-gray-300);
    }

    .uc-info-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--uc-spacing-xs) 0;
        border-bottom: 1px solid var(--uc-gray-100);
    }

    .uc-info-item:last-child {
        border-bottom: none;
    }

    .uc-info-label {
        font-size: var(--uc-font-size-md);
        color: var(--uc-gray-400);
        font-weight: var(--uc-font-weight-normal);
    }

    .uc-info-value {
        font-size: var(--uc-font-size-md);
        font-weight: var(--uc-font-weight-semibold);
        color: var(--uc-gray-800);
        text-align: right;
    }

    /* ВКЛАДКИ */
    .uc-tabs {
        display: flex;
        margin-bottom: var(--uc-gap-xl);
        background: var(--uc-gray-50);
        border-radius: var(--uc-border-radius-md);
        padding: var(--uc-spacing-xs);
        gap: var(--uc-spacing-xs);
    }

    .uc-tab-button {
        flex: 1;
        padding: var(--uc-spacing-md) var(--uc-spacing-lg);
        background: transparent;
        border: none;
        border-radius: var(--uc-border-radius-sm);
        font-size: var(--uc-font-size-base);
        font-weight: var(--uc-font-weight-normal);
        color: var(--uc-gray-400);
        cursor: pointer;
        transition: var(--uc-transition-base);
        text-transform: uppercase;
        letter-spacing: var(--uc-letter-spacing-wide);
    }

    .uc-tab-button:hover {
        background: rgba(0, 0, 0, 0.05);
        color: var(--uc-gray-600);
    }

    .uc-tab-active {
        background: var(--uc-white) !important;
        color: var(--uc-gray-800) !important;
        box-shadow: var(--uc-shadow-sm);
    }

    /* ЗАГОЛОВОК ПАЛИТРЫ */
    .uc-palette-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: var(--uc-spacing-xl);
    }

    .uc-palette-title {
        font-size: var(--uc-font-size-xl);
        font-weight: var(--uc-font-weight-semibold);
        color: var(--uc-gray-800);
    }

    .uc-materials-count {
        font-size: var(--uc-font-size-base);
        color: var(--uc-gray-400);
        background: var(--uc-gray-50);
        padding: var(--uc-spacing-sm) var(--uc-spacing-md);
        border-radius: var(--uc-border-radius-xl);
    }

    /* ПАЛИТРА МАТЕРИАЛОВ */
    .uc-materials-grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: var(--uc-gap-md);
        margin-bottom: var(--uc-spacing-xl);
    }

    .uc-material-item {
        aspect-ratio: 1;
        border: var(--uc-border-width) solid var(--uc-gray-200);
        border-radius: var(--uc-border-radius-md);
        background: var(--uc-white);
        cursor: pointer;
        transition: var(--uc-transition-base);
        position: relative;
        overflow: hidden;
        padding: 0;
    }

    .uc-material-item:hover {
        transform: translateY(-3px);
        box-shadow: var(--uc-shadow-lg);
        border-color: var(--uc-primary-blue);
    }

    .uc-material-selected {
        border-color: var(--uc-primary-blue) !important;
        box-shadow: var(--uc-shadow-focus) !important;
        transform: translateY(-2px) !important;
    }

    .uc-material-thumb {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: var(--uc-transition-base);
    }

    .uc-loading-placeholder {
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: var(--uc-animation-shimmer);
    }

    @keyframes uc-shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
    }

    .uc-fade-in {
        animation: var(--uc-animation-fade);
    }

    @keyframes uc-fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .uc-loading {
        opacity: 0.6;
        pointer-events: none;
    }

    /* АДАПТИВНАЯ ВЕРСТКА */
    
    /* ПЛАНШЕТЫ И МОБИЛЬНЫЕ (ОСНОВНОЕ ИЗМЕНЕНИЕ ПОРЯДКА) */
    @media (max-width: 1023px) {
        .uc-constructor-header {
            grid-template-columns: 1fr;
            gap: var(--uc-spacing-xl);
            min-height: auto;
        }

        .uc-materials-grid {
            grid-template-columns: repeat(8, 1fr);
        }

        /* ИЗМЕНЕН ПОРЯДОК: СНАЧАЛА ПРЕДПРОСМОТР, ПОТОМ ОБРАЗЕЦ */
        .uc-preview-panel {
            order: 1;
            min-height: var(--uc-min-height-md);
        }

        .uc-material-panel {
            order: 2;
        }
    }

    /* ПЛАНШЕТЫ */
    @media (max-width: 1023px) and (min-width: 768px) {
        .uc-materials-grid {
            grid-template-columns: repeat(6, 1fr) !important;
            gap: var(--uc-gap-base);
        }

        .uc-material-item {
            min-height: var(--uc-min-touch-target-xl);
            border-radius: var(--uc-border-radius-gap);
        }

        .uc-tabs {
            margin-bottom: calc(var(--uc-spacing-xl) + var(--uc-spacing-md));
        }

        .uc-tab-button {
            padding: var(--uc-spacing-lg) var(--uc-spacing-xl);
            font-size: var(--uc-font-size-lg);
            min-height: var(--uc-min-touch-target-lg);
        }

        .uc-constructor-header {
            gap: calc(var(--uc-spacing-xl) + var(--uc-spacing-xs));
            margin-bottom: calc(var(--uc-spacing-xl) + var(--uc-spacing-md));
        }

        .uc-material-panel,
        .uc-preview-panel {
            border-radius: var(--uc-border-radius-lg);
        }
    }

    /* МОБИЛЬНЫЕ УСТРОЙСТВА */
    @media (max-width: 767px) {
        .uc-constructor {
            padding: var(--uc-spacing-lg);
        }

        .uc-materials-grid {
            grid-template-columns: repeat(4, 1fr);
            gap: var(--uc-gap-sm);
        }

        .uc-material-panel {
            padding: var(--uc-spacing-lg);
            gap: var(--uc-spacing-lg);
        }

        .uc-material-info {
            padding: var(--uc-spacing-md);
            gap: var(--uc-spacing-sm);
        }

        .uc-tabs {
            flex-direction: row !important;
            gap: 2px;
            padding: var(--uc-spacing-sm);
            margin-bottom: var(--uc-spacing-xl);
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--uc-gray-50);
            border-radius: var(--uc-border-radius);
            box-shadow: var(--uc-shadow-sm);
        }

        .uc-tab-button {
            padding: var(--uc-spacing-base) var(--uc-spacing-sm) !important;
            font-size: var(--uc-font-size-sm) !important;
            font-weight: var(--uc-font-weight-semibold);
            min-height: var(--uc-min-touch-target);
            border-radius: var(--uc-border-radius-md);
            letter-spacing: var(--uc-letter-spacing);
            transition: var(--uc-transition-fast);
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .uc-tab-button:active {
            transform: scale(0.95);
            background: rgba(0, 123, 255, 0.1) !important;
        }

        .uc-materials-grid {
            grid-template-columns: repeat(3, 1fr) !important;
            gap: var(--uc-spacing-md);
            padding: 0 var(--uc-spacing-xs);
        }

        .uc-material-item {
            min-height: var(--uc-min-touch-target);
            min-width: var(--uc-min-touch-target);
            border-radius: var(--uc-border-radius);
            border-width: var(--uc-border-width-thick);
            transition: var(--uc-transition-slow);
            position: relative;
            overflow: hidden;
        }

        .uc-material-item:active {
            transform: scale(0.92);
            box-shadow: var(--uc-shadow-tap);
        }

        .uc-material-item::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle, rgba(0, 123, 255, 0.3) 0%, transparent 70%);
            opacity: 0;
            transition: var(--uc-transition-fast);
            pointer-events: none;
        }

        .uc-material-item:active::after {
            opacity: 1;
        }

        .uc-constructor-header {
            gap: var(--uc-spacing-lg);
            margin-bottom: calc(var(--uc-spacing-xl) + var(--uc-spacing-xs));
        }

        .uc-material-panel {
            padding: var(--uc-spacing-lg);
            gap: var(--uc-spacing-md);
            border-radius: var(--uc-border-radius-lg);
            box-shadow: var(--uc-shadow-md);
        }

        .uc-preview-panel {
            min-height: var(--uc-min-height-sm);
            border-radius: var(--uc-border-radius-lg);
            box-shadow: var(--uc-shadow-md);
        }

        .uc-material-info {
            padding: var(--uc-spacing-lg);
            gap: var(--uc-spacing-md);
            border-radius: var(--uc-border-radius);
        }

        .uc-info-item {
            padding: var(--uc-spacing-sm) 0;
            border-bottom: 1px solid var(--uc-gray-100);
            flex-direction: row !important;
            align-items: center !important;
            justify-content: space-between;
        }

        .uc-info-label {
            font-size: var(--uc-font-size-base) !important;
            font-weight: var(--uc-font-weight-normal);
            color: var(--uc-gray-500);
        }

        .uc-info-value {
            font-size: var(--uc-font-size-base) !important;
            font-weight: var(--uc-font-weight-semibold);
            color: var(--uc-gray-900);
            text-align: right !important;
            max-width: 60%;
            word-break: break-word;
        }

        .uc-palette-header {
            flex-direction: row !important;
            align-items: center !important;
            gap: 0 !important;
            margin-bottom: var(--uc-spacing-lg);
            padding: 0 var(--uc-spacing-xs);
        }

        .uc-palette-title {
            font-size: var(--uc-font-size-2xl) !important;
            font-weight: var(--uc-font-weight-bold);
            color: var(--uc-gray-900);
        }

        .uc-materials-count {
            font-size: var(--uc-font-size-sm);
            padding: var(--uc-spacing-xs) var(--uc-spacing-sm);
            border-radius: var(--uc-border-radius);
            background: var(--uc-primary-blue-bg);
            color: var(--uc-primary-blue-light);
            font-weight: var(--uc-font-weight-normal);
        }

        .uc-sample-label,
        .uc-preview-label {
            font-size: var(--uc-font-size-sm);
            padding: var(--uc-spacing-sm) var(--uc-spacing-sm);
            border-radius: var(--uc-border-radius-md);
            background: var(--uc-black-overlay-light);
            backdrop-filter: blur(4px);
            font-weight: var(--uc-font-weight-semibold);
            letter-spacing: var(--uc-letter-spacing);
        }

        .uc-loading-placeholder {
            border-radius: var(--uc-border-radius-md);
        }

        .uc-fade-in {
            animation: var(--uc-animation-mobile-slide);
        }

        @keyframes uc-mobileSlideIn {
            from {
                opacity: 0;
                transform: translateY(var(--uc-spacing-lg)) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
    }

    /* ОЧЕНЬ МАЛЕНЬКИЕ ЭКРАНЫ */
    @media (max-width: 480px) {
        .uc-materials-grid {
            grid-template-columns: repeat(2, 1fr) !important;
            gap: var(--uc-spacing-lg);
        }

        .uc-material-item {
            aspect-ratio: 1.2;
            min-height: var(--uc-min-touch-target-2xl);
        }

        .uc-constructor {
            padding: var(--uc-spacing-md) var(--uc-spacing-sm);
        }

        .uc-palette-title {
            font-size: var(--uc-font-size-xl) !important;
        }

        .uc-tab-button {
            padding: var(--uc-spacing-md) var(--uc-spacing-sm) !important;
            font-size: var(--uc-font-size-xs) !important;
        }

        .uc-info-item {
            flex-direction: column !important;
            align-items: flex-start !important;
            gap: var(--uc-spacing-xs);
            padding: var(--uc-spacing-md) 0;
        }

        .uc-info-value {
            text-align: left !important;
            max-width: 100%;
            font-size: var(--uc-font-size-lg) !important;
            color: var(--uc-primary-blue-light);
        }

        .uc-info-label {
            font-size: var(--uc-font-size-md) !important;
            color: var(--uc-gray-500);
        }
    }

    /* ACCESSIBILITY */
    @media (prefers-reduced-motion: reduce) {
        .uc-material-item,
        .uc-tab-button,
        .uc-material-panel,
        .uc-preview-panel {
            transition: none !important;
        }

        .uc-fade-in {
            animation: none !important;
        }
    }

    /* ТЕМНАЯ ТЕМА */
    @media (prefers-color-scheme: dark) and (max-width: 767px) {
        .uc-constructor {
            background: var(--uc-dark-bg);
            color: var(--uc-dark-text);
        }

        .uc-material-panel,
        .uc-preview-panel {
            background: var(--uc-dark-surface);
            border-color: var(--uc-dark-border);
        }

        .uc-material-info {
            background: var(--uc-dark-surface-alt);
            border-color: var(--uc-dark-border);
        }

        .uc-tabs {
            background: var(--uc-dark-surface);
        }

        .uc-tab-button {
            color: var(--uc-dark-text-secondary);
        }

        .uc-tab-active {
            background: var(--uc-primary-blue-light) !important;
            color: var(--uc-white) !important;
        }

        .uc-materials-count {
            background: var(--uc-primary-blue-light);
            color: var(--uc-white);
        }
    }

    /* СВАЙП ДЛЯ ПАЛИТРЫ */
    @media (max-width: 767px) {
        .uc-materials-grid {
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding-bottom: var(--uc-spacing-sm);
        }

        .uc-materials-grid::-webkit-scrollbar {
            display: none;
        }

        .uc-material-item {
            scroll-snap-align: start;
            flex-shrink: 0;
        }

        .uc-materials-grid::after {
            content: '← Свайпните для просмотра →';
            position: sticky;
            right: 0;
            background: linear-gradient(90deg, transparent, var(--uc-gray-50) 20%);
            padding: var(--uc-spacing-sm) var(--uc-spacing-md);
            font-size: var(--uc-font-size-xs);
            color: var(--uc-gray-500);
            text-align: center;
            pointer-events: none;
            opacity: 0.7;
        }
    }
    </style>
</head>

<body>
    <div id="uc-material-constructor" x-data="ucMaterialConstructor()" class="uc-constructor">
        <!-- Верхний блок: образец с характеристиками и предпросмотр -->
        <div class="uc-constructor-header">
            <!-- Левая панель: образец материала + характеристики (ЕДИНЫЙ БЛОК) -->
            <div class="uc-material-panel" :class="{ 'uc-loading': isLoading }">
                <div class="uc-material-sample">
                    <div class="uc-sample-label">Образец материала</div>
                    <img x-show="selectedMaterial" :src="materialSampleImage" :alt="selectedMaterial?.name || 'Материал'" class="uc-sample-image" x-transition.opacity.duration.300ms>
                    <div x-show="!selectedMaterial" class="uc-loading-placeholder"></div>
                </div>
                <!-- Характеристики материала -->
                <div x-show="selectedMaterial" class="uc-material-info uc-fade-in">
                    <div class="uc-info-item">
                        <span class="uc-info-label">Название:</span>
                        <span class="uc-info-value" x-text="selectedMaterial?.name || '—'"></span>
                    </div>
                    <div class="uc-info-item">
                        <span class="uc-info-label">Базовый цвет:</span>
                        <span class="uc-info-value" x-text="selectedMaterial?.baseColor || '—'"></span>
                    </div>
                    <div class="uc-info-item">
                        <span class="uc-info-label">Напыление:</span>
                        <span class="uc-info-value" x-text="selectedMaterial?.coating || '—'"></span>
                    </div>
                    <div class="uc-info-item">
                        <span class="uc-info-label">Рельеф:</span>
                        <span class="uc-info-value" x-text="selectedMaterial?.relief || '—'"></span>
                    </div>
                </div>
            </div>
            <!-- Правая панель: предпросмотр дома (ВЫСОКИЙ БЛОК) -->
            <div class="uc-preview-panel" :class="{ 'uc-loading': isLoading }">
                <div class="uc-preview-label">Предпросмотр на доме</div>
                <img x-show="selectedMaterial" :src="housePreviewImage" :alt="'Дом с материалом ' + (selectedMaterial?.name || '')" class="uc-preview-image" x-transition.opacity.duration.300ms>
                <div x-show="!selectedMaterial" class="uc-loading-placeholder"></div>
            </div>
        </div>

        <!-- Навигационные вкладки -->
        <nav class="uc-tabs">
            <template x-for="tab in tabs" :key="tab.id">
                <button @click="activeTab = tab.id; filterMaterials()" :class="{ 'uc-tab-active': activeTab === tab.id }" class="uc-tab-button" x-text="tab.label">
                </button>
            </template>
        </nav>

        <!-- Заголовок палитры -->
        <div class="uc-palette-header">
            <h3 class="uc-palette-title" x-text="currentTabLabel"></h3>
            <div class="uc-materials-count" x-text="filteredMaterials.length + ' материалов'"></div>
        </div>

        <!-- Палитра материалов -->
        <div class="uc-materials-grid">
            <template x-for="material in filteredMaterials" :key="material.id">
                <button @click="selectMaterial(material)" :class="{ 'uc-material-selected': selectedMaterial?.id === material.id }" class="uc-material-item" :title="material.name">
                    <img x-intersect.once="loadMaterialImage" :data-src="material.thumbnail" :alt="material.name" class="uc-material-thumb" loading="lazy">
                </button>
            </template>
        </div>
    </div>

    <script>
    // [Весь JavaScript код остается без изменений]
    // Безопасная функция для кодирования Unicode в base64
    function safeBase64Encode(str) {
        try {
            // Проверяем поддержку TextEncoder
            if (typeof TextEncoder !== 'undefined') {
                const bytes = new TextEncoder().encode(str);
                const binString = String.fromCodePoint(...bytes);
                return btoa(binString);
            } else {
                // Fallback для старых браузеров
                return btoa(unescape(encodeURIComponent(str)));
            }
        } catch (e) {
            console.warn('Error encoding string to base64:', e);
            // Возвращаем простую заглушку в случае ошибки
            return 'data:image/svg+xml;base64,' + btoa('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 100"><rect width="200" height="100" fill="#ccc"/></svg>');
        }
    }

    // Функция для создания SVG заглушек (ТОЛЬКО ASCII СИМВОЛЫ)
    function createBrickSVG(color1 = '#8B4513', color2 = '#A0522D', id = '') {
        const svgString = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 100">
        <defs>
            <pattern id="brick${id}" patternUnits="userSpaceOnUse" width="40" height="20">
                <rect width="40" height="20" fill="${color1}"/>
                <rect width="20" height="10" fill="${color2}"/>
                <rect x="20" y="10" width="20" height="10" fill="${color2}"/>
                <rect width="40" height="1" fill="#654321" opacity="0.3"/>
                <rect width="1" height="20" fill="#654321" opacity="0.3"/>
                <rect x="20" width="1" height="20" fill="#654321" opacity="0.3"/>
                <rect y="10" width="40" height="1" fill="#654321" opacity="0.3"/>
            </pattern>
        </defs>
        <rect width="200" height="100" fill="url(#brick${id})"/>
    </svg>`;

        return `data:image/svg+xml;base64,${safeBase64Encode(svgString)}`;
    }

    function createHouseSVG(roofColor = '#8B4513', wallColor = '#D2B48C') {
        const svgString = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300">
        <rect width="400" height="300" fill="#87CEEB"/>
        <rect y="250" width="400" height="50" fill="#90EE90"/>
        <rect x="100" y="150" width="200" height="100" fill="${wallColor}" stroke="#999" stroke-width="2"/>
        <polygon points="80,150 200,100 320,150" fill="${roofColor}" stroke="#654321" stroke-width="2"/>
        <rect x="180" y="200" width="40" height="50" fill="#8B4513" stroke="#654321" stroke-width="1"/>
        <circle cx="210" cy="225" r="2" fill="#FFD700"/>
        <rect x="120" y="170" width="30" height="25" fill="#87CEEB" stroke="#654321" stroke-width="1"/>
        <rect x="250" y="170" width="30" height="25" fill="#87CEEB" stroke="#654321" stroke-width="1"/>
        <line x1="135" y1="170" x2="135" y2="195" stroke="#654321" stroke-width="1"/>
        <line x1="120" y1="182.5" x2="150" y2="182.5" stroke="#654321" stroke-width="1"/>
        <line x1="265" y1="170" x2="265" y2="195" stroke="#654321" stroke-width="1"/>
        <line x1="250" y1="182.5" x2="280" y2="182.5" stroke="#654321" stroke-width="1"/>
        <rect x="240" y="110" width="15" height="30" fill="#696969" stroke="#555" stroke-width="1"/>
        <circle cx="250" cy="100" r="8" fill="#D3D3D3" opacity="0.7"/>
        <circle cx="245" cy="90" r="6" fill="#D3D3D3" opacity="0.5"/>
        <circle cx="255" cy="85" r="5" fill="#D3D3D3" opacity="0.3"/>
    </svg>`;

        return `data:image/svg+xml;base64,${safeBase64Encode(svgString)}`;
    }

    // Инициализация Alpine.js компонента
    document.addEventListener('alpine:init', () => {
        Alpine.data('ucMaterialConstructor', () => ({
            // Состояние приложения
            activeTab: 'facade',
            selectedMaterial: null,
            isLoading: false,

            // Вкладки
            tabs: [
                { id: 'facade', label: 'Фасад' },
                { id: 'basement', label: 'Цоколь' },
                { id: 'fence', label: 'Забор' }
            ],

            // Материалы (с SVG заглушками)
            materials: [
                // Фасадные материалы
                { id: 'GS1-T1-2', name: 'GS1-T1-2', baseColor: 'Красный', coating: 'Черное по диагонали', relief: 'Земля', category: 'facade', thumbnail: createBrickSVG('#8B4513', '#A0522D', '1') },
                { id: 'GS1-T1-3', name: 'GS1-T1-3', baseColor: 'Коричневый', coating: 'Матовое', relief: 'Гладкий', category: 'facade', thumbnail: createBrickSVG('#8B4513', '#CD853F', '2') },
                { id: 'GS1-T2-1', name: 'GS1-T2-1', baseColor: 'Серый', coating: 'Глянцевое', relief: 'Рифленый', category: 'facade', thumbnail: createBrickSVG('#696969', '#808080', '3') },
                { id: 'GS1-T2-2', name: 'GS1-T2-2', baseColor: 'Белый', coating: 'Полуматовое', relief: 'Земля', category: 'facade', thumbnail: createBrickSVG('#F5F5DC', '#FFFAF0', '4') },
                { id: 'GS1-T2-3', name: 'GS1-T2-3', baseColor: 'Желтый', coating: 'Сатин', relief: 'Кирпич', category: 'facade', thumbnail: createBrickSVG('#DAA520', '#F0E68C', '5') },
                { id: 'GS1-T3-1', name: 'GS1-T3-1', baseColor: 'Черный', coating: 'Глянец', relief: 'Камень', category: 'facade', thumbnail: createBrickSVG('#2F4F4F', '#696969', '6') },
                { id: 'GS1-T3-2', name: 'GS1-T3-2', baseColor: 'Зеленый', coating: 'Матовое', relief: 'Дерево', category: 'facade', thumbnail: createBrickSVG('#556B2F', '#6B8E23', '7') },
                { id: 'GS1-T3-3', name: 'GS1-T3-3', baseColor: 'Синий', coating: 'Полуглянец', relief: 'Плитка', category: 'facade', thumbnail: createBrickSVG('#4682B4', '#5F9EA0', '8') },
                { id: 'GS1-T4-1', name: 'GS1-T4-1', baseColor: 'Оранжевый', coating: 'Текстура', relief: 'Кора', category: 'facade', thumbnail: createBrickSVG('#FF8C00', '#FFA500', '9') },
                { id: 'GS1-T4-2', name: 'GS1-T4-2', baseColor: 'Фиолетовый', coating: 'Металлик', relief: 'Волна', category: 'facade', thumbnail: createBrickSVG('#8A2BE2', '#9370DB', '10') },
                { id: 'GS1-T4-3', name: 'GS1-T4-3', baseColor: 'Розовый', coating: 'Перламутр', relief: 'Мрамор', category: 'facade', thumbnail: createBrickSVG('#FFC0CB', '#FFB6C1', '11') },
                { id: 'GS1-T5-1', name: 'GS1-T5-1', baseColor: 'Бежевый', coating: 'Кракелюр', relief: 'Штукатурка', category: 'facade', thumbnail: createBrickSVG('#F5F5DC', '#D2B48C', '12') },

                // Цокольные материалы
                { id: 'BS1-C1-1', name: 'BS1-C1-1', baseColor: 'Серый', coating: 'Рустик', relief: 'Камень', category: 'basement', thumbnail: createBrickSVG('#708090', '#2F4F4F', 'b1') },
                { id: 'BS1-C1-2', name: 'BS1-C1-2', baseColor: 'Коричневый', coating: 'Антик', relief: 'Скала', category: 'basement', thumbnail: createBrickSVG('#8B4513', '#654321', 'b2') },
                { id: 'BS1-C2-1', name: 'BS1-C2-1', baseColor: 'Черный', coating: 'Гранит', relief: 'Полированный', category: 'basement', thumbnail: createBrickSVG('#2F2F2F', '#000000', 'b3') },
                { id: 'BS1-C2-2', name: 'BS1-C2-2', baseColor: 'Красный', coating: 'Клинкер', relief: 'Кирпич', category: 'basement', thumbnail: createBrickSVG('#B22222', '#8B0000', 'b4') },
                { id: 'BS1-C3-1', name: 'BS1-C3-1', baseColor: 'Бежевый', coating: 'Песчаник', relief: 'Природный', category: 'basement', thumbnail: createBrickSVG('#F5DEB3', '#DEB887', 'b5') },
                { id: 'BS1-C3-2', name: 'BS1-C3-2', baseColor: 'Зеленый', coating: 'Мох', relief: 'Старинный', category: 'basement', thumbnail: createBrickSVG('#9ACD32', '#556B2F', 'b6') },
                { id: 'BS1-C4-1', name: 'BS1-C4-1', baseColor: 'Синий', coating: 'Сланец', relief: 'Слоистый', category: 'basement', thumbnail: createBrickSVG('#4682B4', '#2F4F4F', 'b7') },
                { id: 'BS1-C4-2', name: 'BS1-C4-2', baseColor: 'Желтый', coating: 'Известняк', relief: 'Пористый', category: 'basement', thumbnail: createBrickSVG('#F0E68C', '#BDB76B', 'b8') },

                // Заборные материалы
                { id: 'FS1-F1-1', name: 'FS1-F1-1', baseColor: 'Коричневый', coating: 'Дерево', relief: 'Доска', category: 'fence', thumbnail: createBrickSVG('#8B4513', '#A0522D', 'f1') },
                { id: 'FS1-F1-2', name: 'FS1-F1-2', baseColor: 'Серый', coating: 'Металл', relief: 'Профлист', category: 'fence', thumbnail: createBrickSVG('#696969', '#C0C0C0', 'f2') },
                { id: 'FS1-F2-1', name: 'FS1-F2-1', baseColor: 'Зеленый', coating: 'Полимер', relief: 'Сетка', category: 'fence', thumbnail: createBrickSVG('#228B22', '#32CD32', 'f3') },
                { id: 'FS1-F2-2', name: 'FS1-F2-2', baseColor: 'Белый', coating: 'Штакетник', relief: 'Вертикальный', category: 'fence', thumbnail: createBrickSVG('#FFFFFF', '#F8F8FF', 'f4') },
                { id: 'FS1-F3-1', name: 'FS1-F3-1', baseColor: 'Черный', coating: 'Кованый', relief: 'Узорный', category: 'fence', thumbnail: createBrickSVG('#000000', '#2F2F2F', 'f5') },
                { id: 'FS1-F3-2', name: 'FS1-F3-2', baseColor: 'Красный', coating: 'Кирпич', relief: 'Блочный', category: 'fence', thumbnail: createBrickSVG('#DC143C', '#B22222', 'f6') },
                { id: 'FS1-F4-1', name: 'FS1-F4-1', baseColor: 'Бежевый', coating: 'Камень', relief: 'Булыжник', category: 'fence', thumbnail: createBrickSVG('#D2B48C', '#DEB887', 'f7') },
                { id: 'FS1-F4-2', name: 'FS1-F4-2', baseColor: 'Синий', coating: 'Пластик', relief: 'Сайдинг', category: 'fence', thumbnail: createBrickSVG('#4169E1', '#6495ED', 'f8') }
            ],

            filteredMaterials: [],

            // Инициализация компонента
            init() {
                this.filterMaterials();
                // Выбираем первый материал по умолчанию
                if (this.filteredMaterials.length > 0) {
                    this.selectedMaterial = this.filteredMaterials[0];
                }
            },

            // Вычисляемые свойства
            get currentTabLabel() {
                const tab = this.tabs.find(t => t.id === this.activeTab);
                return tab ? tab.label : '';
            },

            get materialSampleImage() {
                return this.selectedMaterial ? this.selectedMaterial.thumbnail : '';
            },

            get housePreviewImage() {
                if (!this.selectedMaterial) return '';

                // Создаем дом с цветом выбранного материала
                const colorMap = {
                    'Красный': '#8B4513',
                    'Коричневый': '#8B4513',
                    'Серый': '#696969',
                    'Белый': '#F5F5DC',
                    'Желтый': '#DAA520',
                    'Черный': '#2F4F4F',
                    'Зеленый': '#556B2F',
                    'Синий': '#4682B4',
                    'Оранжевый': '#FF8C00',
                    'Фиолетовый': '#8A2BE2',
                    'Розовый': '#FFC0CB',
                    'Бежевый': '#F5F5DC'
                };

                const wallColor = colorMap[this.selectedMaterial.baseColor] || '#D2B48C';
                return createHouseSVG('#8B4513', wallColor);
            },

            // Методы
            filterMaterials() {
                this.filteredMaterials = this.materials.filter(m => m.category === this.activeTab);

                // Если выбранный материал не подходит под фильтр, сбрасываем выбор
                if (this.selectedMaterial && this.selectedMaterial.category !== this.activeTab) {
                    this.selectedMaterial = this.filteredMaterials.length > 0 ? this.filteredMaterials[0] : null;
                }
            },

            selectMaterial(material) {
                this.isLoading = true;

                // Имитация загрузки
                setTimeout(() => {
                    this.selectedMaterial = material;
                    this.isLoading = false;

                    // Сохраняем выбор в localStorage
                    localStorage.setItem('uc-selected-material', JSON.stringify(material));
                }, 300);
            },

            loadMaterialImage() {
                const img = this.$el;
                const src = img.getAttribute('data-src');

                if (src && !img.src) {
                    img.src = src;
                    img.onload = () => {
                        img.style.opacity = '1';
                    };
                }
            }
        }));
    });

    // Загрузка сохраненного состояния при загрузке страницы
    document.addEventListener('DOMContentLoaded', () => {
        const saved = localStorage.getItem('uc-selected-material');
        if (saved) {
            try {
                const material = JSON.parse(saved);
                // Восстанавливаем состояние через событие
                setTimeout(() => {
                    const constructor = document.querySelector('#uc-material-constructor');
                    if (constructor && constructor._x_dataStack) {
                        const data = constructor._x_dataStack[0];
                        data.selectedMaterial = material;
                        data.activeTab = material.category;
                        data.filterMaterials();
                    }
                }, 100);
            } catch (e) {
                console.warn('Не удалось восстановить сохраненный материал');
            }
        }
    });
    </script>
</body>

</html>
