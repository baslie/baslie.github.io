<!DOCTYPE html>
<html lang="ru" itemscope itemtype="https://schema.org/WebApplication">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- SEO Meta Tags -->
    <title>
        QR Code Tools - Онлайн сканер и генератор QR-кодов
    </title>
    <meta name="description" content="Бесплатный онлайн сканер QR-кодов. Сканируйте QR-коды с камеры, загружайте изображения или PDF файлы. Быстро, безопасно и удобно.">
    <meta name="keywords" content="QR код, сканер, генератор, онлайн, бесплатно, камера, PDF, изображения">
    <meta name="author" content="QR Code Tools">
    <meta name="robots" content="index, follow">
    <!-- <link rel="canonical" href="https://our-qr-code-tools-domain.com/"> -->
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <!-- <meta property="og:url" content="https://our-qr-code-tools-domain.com/"> -->
    <meta property="og:title" content="QR Code Tools - Онлайн сканер и генератор QR-кодов">
    <meta property="og:description" content="Бесплатный онлайн сканер QR-кодов. Сканируйте QR-коды с камеры, загружайте изображения или PDF файлы.">
    <meta property="og:image" content="assets/images/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="QR Code Tools">
    <meta property="og:locale" content="ru_RU">
    <meta property="og:site_name" content="QR Code Tools">
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <!-- <meta property="twitter:url" content="https://our-qr-code-tools-domain.com/"> -->
    <meta property="twitter:title" content="QR Code Tools">
    <meta property="twitter:description" content="Бесплатный онлайн сканер QR-кодов. Сканируйте QR-коды с камеры, загружайте изображения или PDF файлы.">
    <meta property="twitter:image" content="assets/images/twitter-image.jpg">
    <meta property="twitter:image:alt" content="QR Code Tools">
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <!-- <link rel="manifest" href="/site.webmanifest"> -->
    <meta name="theme-color" content="#222222">
    <!-- Schema.org JSON-LD -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "QR Code Tools",
        "description": "Бесплатный онлайн сканер и генератор QR-кодов. Сканируйте QR-коды с камеры, загружайте изображения или PDF файлы.",
        /*"url": "https://our-qr-code-tools-domain.com/",*/
        "applicationCategory": "Utility",
        "operatingSystem": "Any",
        "browserRequirements": "Requires JavaScript. Requires HTML5.",
        "softwareVersion": "1.0",
        "dateCreated": "2024-01-01",
        "dateModified": "2024-07-06",
        "inLanguage": "ru",
        "isAccessibleForFree": true,
        "author": {
            "@type": "Organization",
            "name": "QR Code Tools"
        },
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "RUR"
        },
        "featureList": [
            "Сканирование QR-кодов с камеры",
            "Загрузка изображений для сканирования",
            "Поддержка PDF файлов",
            "Мгновенное распознавание",
            "Копирование результата",
            "Открытие ссылок"
        ],
        /*"screenshot": "https://our-qr-code-tools-domain.com/assets/images/screenshot.jpg"*/
    }
    </script>
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <!-- Fonts with display=swap for performance -->
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400&display=swap" rel="stylesheet">
    <style>
        /* ======================================================================
     Design Tokens (CSS Custom Properties)
     ====================================================================== */
    :root {
        /* Fonts */
        --font-base: 'Fira Sans', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        --font-size-base: 16px;

        /* Colors (light theme) */
        --color-text: #222222;
        --color-bg: #ffffff;
        --color-muted: #f1f1f1;
        --color-accent: #222222;
        --color-border: rgba(0, 0, 0, .15);
        --color-border-light: rgba(0, 0, 0, .4);
        --color-success: #28a745;
        --color-error: #dc3545;
        --color-warning: #ffc107;

        /* Spacing and sizes */
        --spacing: 15px;
        --spacing-sm: 10px;
        --spacing-xs: 6px;
        --radius-lg: 12px;
        --radius-md: 8px;
        --radius-sm: 4px;
        --radius-pill: 100px;
        --header-height: 28px;
        --upload-height-desktop: 80px;
        --upload-height-mobile: 120px;
        
        /* Typography */
        --font-size-sm: 0.9rem;
        --font-size-xs: 0.85rem;
        --line-height-normal: 1.3;
        --line-height-relaxed: 1.4;
        
        /* Opacity values */
        --opacity-muted: 0.8;
        --opacity-disabled: 0.5;

        /* Motion */
        --easing: cubic-bezier(.4, 0, .2, 1);
        --transition: .3s var(--easing);
    }

    /* Dark theme */
    @media (prefers-color-scheme: dark) {
        :root {
            --color-text: #e5e5e5;
            --color-bg: #121212;
            --color-muted: #1e1e1e;
            --color-accent: #ffffff;
            --color-border: rgba(255, 255, 255, .15);
            --color-border-light: rgba(255, 255, 255, .4);
        }
    }

    /* Reduced-motion */
    @media (prefers-reduced-motion: reduce) {
        * {
            transition: none !important;
            animation: none !important;
        }
    }

    /* ======================================================================
     CSS Reset (minimal required)
     ====================================================================== */
    *,
    *::before,
    *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    html {
        line-height: 1.15;
        -webkit-text-size-adjust: 100%;
        -webkit-tap-highlight-color: transparent;
        scroll-behavior: smooth;
    }

    body,
    main,
    header,
    section,
    article,
    aside,
    footer,
    nav {
        display: block;
    }

    img,
    svg {
        max-width: 100%;
        height: auto;
        vertical-align: middle;
    }

    ul,
    ol {
        list-style: none;
    }

    table {
        border-collapse: collapse;
        border-spacing: 0;
    }

    input,
    button,
    textarea,
    select {
        font: inherit;
        color: inherit;
        background: none;
        border: 0;
    }

    button {
        cursor: pointer;
        outline: none;
    }

    /* ======================================================================
     Base Styles
     ====================================================================== */
    body {
        font-family: var(--font-base);
        font-size: var(--font-size-base);
        line-height: 1;
        color: var(--color-text);
        background: var(--color-bg);
        height: 100vh;
        padding: var(--spacing);
        display: flex;
        flex-direction: column;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        box-sizing: border-box;
    }

    .app-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    /* ======================================================================
     Header
     ====================================================================== */
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing);
        gap: var(--spacing);
    }

    .logo img {
        height: var(--header-height);
        width: auto;
    }

    .switcher-background {
        display: flex;
        align-items: center;
        background: var(--color-muted);
        border-radius: var(--radius-pill);
        padding: var(--spacing-xs);
        position: relative;
    }

    .switcher-slider {
        position: absolute;
        top: var(--spacing-xs);
        left: 0;
        height: 26px;
        background: var(--color-accent);
        border-radius: var(--radius-pill);
        transition: transform var(--transition), width var(--transition);
        z-index: 10;
    }

    .switcher-btn {
        flex: 1;
        height: 26px;
        padding: 0 12px;
        border-radius: var(--radius-pill);
        background: transparent;
        color: var(--color-text);
        display: flex;
        align-items: center;
        justify-content: center;
        white-space: nowrap;
        position: relative;
        z-index: 20;
        transition: color var(--transition);
        line-height: 1;
    }

    .switcher-btn--active {
        color: var(--color-bg);
    }

    /* ======================================================================
     Main Layout
     ====================================================================== */
    .main-layout {
        display: flex;
        gap: var(--spacing);
        flex: 1;
    }

    .control-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .result-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    /* ======================================================================
     Upload Sections
     ====================================================================== */
    .upload-sections {
        display: flex;
        flex-direction: column;
        gap: var(--spacing);
        flex: 1;
    }

    .upload-section {
        width: 100%;
        flex: 1;
        border: 2px dashed var(--color-border);
        border-radius: var(--radius-md);
        padding: var(--spacing);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: transform var(--transition), background var(--transition);
        background: var(--color-bg);
        position: relative;
        overflow: hidden;
    }

    .upload-section--photo {
        padding: 0;
        position: relative;
    }

    .upload-section--photo.camera-active {
        border: 2px solid var(--color-accent);
    }

    @media (hover: hover) {
        .upload-section:hover {
            background: var(--color-muted);
        }
    }

    .upload-section:active {
        transform: scale(.98);
    }

    .upload-section--disabled {
        opacity: var(--opacity-disabled);
        cursor: not-allowed;
        pointer-events: none;
    }

    .upload-icon {
        margin-right: var(--spacing-sm);
        opacity: var(--opacity-muted);
        flex-shrink: 0;
        width: 40px;
        height: 30px;
    }

    .upload-text {
        white-space: nowrap;
        text-align: center;
        flex-shrink: 0;
    }

    /* Hidden file input */
    .file-input {
        position: absolute;
        opacity: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
    }

    /* ======================================================================
     Camera Section
     ====================================================================== */
    .photo-content {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        position: relative;
    }

    .photo-content--camera {
        padding: 0;
    }

    .photo-placeholder {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: row;
    }

    .photo-placeholder--hidden {
        display: none;
    }

    #qr-video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: var(--radius-md);
        background: var(--color-text);
        z-index: 1;
        display: none;
    }

    #qr-video.active {
        display: block !important;
        opacity: 1 !important;
        width: 100% !important;
        height: 100% !important;
        transform: none !important;
    }

    .camera-overlay {
        position: absolute;
        bottom: var(--spacing);
        left: 50%;
        transform: translateX(-50%);
        display: none;
        gap: 10px;
        z-index: 100;
    }

    .camera-overlay.active {
        display: flex;
    }
    
    

    .camera-btn {
        padding: 8px 16px;
        border-radius: var(--radius-pill);
        background: var(--color-accent);
        color: var(--color-bg);
        border: none;
        cursor: pointer;
        transition: opacity var(--transition);
        font-size: var(--font-size-sm);
    }

    .camera-btn:hover {
        opacity: var(--opacity-muted);
    }

    .camera-btn:disabled {
        opacity: var(--opacity-disabled);
        cursor: not-allowed;
    }

    /* ======================================================================
     Result Section
     ====================================================================== */
    .result-section {
        width: 100%;
        flex: 1;
        background: var(--color-muted);
        border-radius: var(--radius-md);
        padding: var(--spacing);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
    }

    .result-icon {
        width: 40px;
        height: 40px;
        margin-bottom: 15px;
        opacity: var(--opacity-muted);
        flex-shrink: 0;
    }

    .result-text {
        color: var(--color-border-light);
        white-space: nowrap;
        margin-bottom: 15px;
    }

    .result-content {
        display: none;
    }

    .result-content--visible {
        display: block;
        width: 100%;
    }

    .result-data {
        background: var(--color-bg);
        border-radius: var(--radius-md);
        padding: var(--spacing);
        margin-bottom: var(--spacing);
        word-break: break-all;
        white-space: pre-wrap;
        max-height: 200px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 0.9rem;
        line-height: 1.4;
    }

    .result-actions {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .result-btn {
        padding: 10px 20px;
        border-radius: var(--radius-pill);
        background: var(--color-accent);
        color: var(--color-bg);
        border: none;
        cursor: pointer;
        transition: opacity var(--transition);
        font-size: 0.9rem;
    }

    .result-btn:hover {
        opacity: 0.8;
    }

    .result-btn--success {
        background: var(--color-success);
    }

    /* ======================================================================
     Status Messages
     ====================================================================== */
    .status-message {
        position: fixed;
        top: var(--spacing);
        right: var(--spacing);
        padding: 12px var(--spacing);
        border-radius: var(--radius-md);
        color: var(--color-bg);
        font-size: 0.9rem;
        z-index: 9999;
        transform: translateX(100%);
        transition: transform var(--transition);
        max-width: 300px;
        word-wrap: break-word;
    }

    .status-message--visible {
        transform: translateX(0);
    }

    .status-message--success {
        background: var(--color-success);
    }

    .status-message--error {
        background: var(--color-error);
    }

    .status-message--warning {
        background: var(--color-warning);
        color: var(--color-text);
    }

    /* ======================================================================
     Loading Indicator
     ====================================================================== */
    .loading {
        display: none;
        margin-top: 10px;
    }

    .loading--visible {
        display: block;
    }

    .loading-spinner {
        width: 20px;
        height: 20px;
        border: 2px solid var(--color-border);
        border-top: 2px solid var(--color-accent);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* ======================================================================
     Accessibility
     ====================================================================== */
    .skip-to-main {
        position: absolute;
        top: -40px;
        left: 6px;
        background: var(--color-accent);
        color: var(--color-bg);
        padding: 8px;
        text-decoration: none;
        z-index: 9998;
        border-radius: var(--radius-sm);
        font-size: 14px;
        transition: top var(--transition);
    }

    .skip-to-main:focus {
        top: 6px;
    }

    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }

    /* Focus styles for better accessibility */
    button:focus,
    input:focus {
        outline: 2px solid var(--color-accent);
        outline-offset: 2px;
    }

    /* High contrast mode support */
    @media (prefers-contrast: high) {
        :root {
            --color-border: rgba(0, 0, 0, 0.8);
            --color-border-light: rgba(0, 0, 0, 0.9);
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --color-border: rgba(255, 255, 255, 0.8);
                --color-border-light: rgba(255, 255, 255, 0.9);
            }
        }
    }

    /* ======================================================================
     Canvas for PDF rendering
     ====================================================================== */
    .pdf-canvas {
        display: none;
    }

    /* ======================================================================
     Responsive Helpers
     ====================================================================== */
    @media screen and (max-width: 768px) {
        body {
            padding: 10px;
            height: auto;
            min-height: 100vh;
        }

        .app-container {
            height: auto;
            min-height: calc(100vh - 20px);
        }

        .main-content {
            flex: 1;
            height: auto;
        }

        .header {
            flex-direction: column;
            margin-bottom: 15px;
            gap: 10px;
        }

        /* Полностью вертикальная структура для мобильных */
        .main-layout {
            flex-direction: column;
            gap: 15px;
            height: auto;
        }

        .control-panel {
            flex: none;
            width: 100%;
            order: 1;
        }

        .photo-placeholder {
            gap: var(--spacing-sm);
        }
        
        .result-panel {
            flex: none;
            width: 100%;
            order: 2;
        }

        .upload-sections {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
        }

        .upload-section {
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            border: 2px dashed var(--color-border);
            border-radius: var(--radius-md);
            background: var(--color-bg);
            cursor: pointer;
        }

        /* 1. КВАДРАТНАЯ область для камеры (сверху) */
        .upload-section--photo {
            aspect-ratio: 1 / 1;
            width: 100%;
            max-width: 100%;
            height: auto;
            padding: 0;
            position: relative;
            overflow: hidden;
        }
        
        /* Принудительное квадратное соотношение для старых браузеров */
        .upload-section--photo::before {
            content: "";
            display: block;
            padding-top: 100%; /* 1:1 Aspect Ratio */
        }
        
        .upload-section--photo .photo-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
        }

        /* 2. ПРЯМОУГОЛЬНАЯ область для загрузки файлов */
        .upload-section--upload {
            aspect-ratio: unset;
            width: 100%;
            height: 100px;
            min-height: 100px;
            max-height: 120px;
        }

        /* 3. Область результата (снизу) */
        .result-section {
            width: 100%;
            height: auto;
            min-height: 200px;
            max-height: 300px;
            overflow-y: auto;
        }

        /* Оптимизация иконок и текста */
        .upload-icon {
            width: 32px;
            height: 24px;
            margin-right: 0;
            margin-bottom: 8px;
        }

        .upload-text {
            font-size: 0.9rem;
            line-height: 1.3;
            white-space: normal;
        }

        .result-icon {
            width: 36px;
            height: 36px;
            margin-bottom: 12px;
        }

        .result-text {
            font-size: 0.9rem;
            line-height: 1.3;
            margin-bottom: 15px;
        }

        /* Кнопки */
        .camera-btn,
        .result-btn {
            padding: 10px 16px;
            font-size: 0.9rem;
            border-radius: var(--radius-pill);
        }

        .result-actions {
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Камера */
        #qr-video {
            border-radius: var(--radius-md);
        }
        
        .camera-overlay {
            bottom: var(--spacing);
            gap: 12px;
        }
        
        /* Результат */
        .result-data {
            font-size: 0.85rem;
            max-height: 120px;
            line-height: 1.4;
        }

        /* Статусные сообщения */
        .status-message {
            top: 10px;
            right: 10px;
            left: 10px;
            max-width: none;
            transform: translateY(-100%);
        }

        .status-message--visible {
            transform: translateY(0);
        }
    }
    
    /* Дополнительные оптимизации для маленьких экранов */
    @media screen and (max-width: 480px) {
        body {
            padding: 10px;
        }
        
        .upload-sections {
            gap: 10px;
        }
        
        .main-layout {
            gap: 10px;
        }
        
        .header {
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .upload-section {
            padding: 15px;
        }
        
        .result-section {
            padding: 15px;
            min-height: 180px;
        }
    }
    </style>
</head>

<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-to-main" aria-label="Перейти к основному содержимому">Перейти к содержимому</a>
    <div class="app-container">
        <!-- Header -->
        <header class="header" role="banner">
            <div class="logo">
                <img src="assets/images/qr-code-tools-logo.svg" alt="QR Code Tools - логотип приложения" width="192" height="28" loading="eager">
            </div>
            <nav class="switcher" role="navigation" aria-label="Переключение между функциями">
                <div class="switcher-background">
                    <div class="switcher-slider" aria-hidden="true"></div>
                    <button class="switcher-btn switcher-btn--active" data-tab="scanner" aria-pressed="true" aria-describedby="scanner-description">Сканер</button>
                    <button class="switcher-btn" data-tab="generator" aria-pressed="false" aria-describedby="generator-description">Генератор</button>
                </div>
                <div id="scanner-description" class="sr-only">Сканирование QR-кодов с камеры или файлов</div>
                <div id="generator-description" class="sr-only">Создание QR-кодов из текста или ссылок</div>
            </nav>
        </header>
        <!-- Main Content -->
        <main class="main-content" id="main-content" role="main">
            <h1 class="sr-only">QR Code Scanner - Сканер QR-кодов</h1>
            <div class="main-layout">
                <!-- Control Panel (Left side) -->
                <section class="control-panel" aria-labelledby="control-heading">
                    <h2 id="control-heading" class="sr-only">Способы сканирования QR-кода</h2>
                    <!-- Upload Sections -->
                    <div class="upload-sections">
                        <div class="upload-section upload-section--photo" id="camera-btn" role="button" tabindex="0" aria-label="Использовать камеру для сканирования QR-кода">
                            <div class="photo-content" id="photo-content">
                                <div class="photo-placeholder" id="photo-placeholder">
                                    <img src="assets/images/photo.svg" alt="" class="upload-icon upload-icon--photo" width="40" height="30" aria-hidden="true" loading="lazy">
                                    <span class="upload-text">Сделать фото</span>
                                </div>
                                <video id="qr-video" autoplay muted playsinline aria-label="Видеопоток с камеры для сканирования QR-кода"></video>
                                <div class="camera-overlay" id="camera-overlay" role="group" aria-label="Управление камерой">
                                    <button class="camera-btn" id="stop-scan-btn" aria-describedby="stop-scan-desc">Остановить</button>
                                </div>
                                <div id="stop-scan-desc" class="sr-only">Остановить сканирование и закрыть камеру</div>
                                <div class="loading" id="camera-loading" aria-live="polite" aria-label="Загрузка камеры">
                                    <div class="loading-spinner" aria-hidden="true"></div>
                                    <span class="sr-only">Инициализация камеры...</span>
                                </div>
                            </div>
                        </div>
                        <label class="upload-section upload-section--upload" for="file-input" id="file-upload-btn" aria-describedby="file-upload-desc">
                            <img src="assets/images/upload.svg" alt="" class="upload-icon upload-icon--upload" width="32" height="30" aria-hidden="true" loading="lazy">
                            <span class="upload-text">Загрузить изображение</span>
                            <input type="file" id="file-input" class="file-input" accept="image/*,.pdf,.gif" multiple aria-describedby="file-upload-desc">
                            <div id="file-upload-desc" class="sr-only">Выберите изображения или PDF файлы для сканирования QR-кодов</div>
                            <div class="loading" id="upload-loading" aria-live="polite" aria-label="Обработка файла">
                                <div class="loading-spinner" aria-hidden="true"></div>
                                <span class="sr-only">Обработка файла...</span>
                            </div>
                        </label>
                    </div>
                </section>
                <!-- Result Panel (Right side) -->
                <section class="result-panel" aria-labelledby="result-heading">
                    <h2 id="result-heading" class="sr-only">Результат сканирования</h2>
                    <div class="result-section" id="result-section" role="region" aria-live="polite" aria-labelledby="result-text">
                        <img src="assets/images/qr-result.svg" alt="" class="result-icon" id="result-icon" width="40" height="40" aria-hidden="true" loading="lazy">
                        <span class="result-text" id="result-text">Результат сканирования</span>
                        <div class="result-content" id="result-content">
                            <div class="result-data" id="result-data" role="textbox" aria-readonly="true" aria-label="Содержимое QR-кода"></div>
                            <div class="result-actions" role="group" aria-label="Действия с результатом">
                                <button class="result-btn" id="copy-btn" aria-describedby="copy-desc">Копировать</button>
                                <button class="result-btn" id="open-link-btn" style="display: none;" aria-describedby="open-link-desc">Открыть ссылку</button>
                                <button class="result-btn" id="clear-btn" aria-describedby="clear-desc">Очистить</button>
                            </div>
                            <div id="copy-desc" class="sr-only">Скопировать результат в буфер обмена</div>
                            <div id="open-link-desc" class="sr-only">Открыть ссылку в новой вкладке</div>
                            <div id="clear-desc" class="sr-only">Очистить результат сканирования</div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>
    <!-- Hidden canvas for PDF rendering -->
    <canvas id="pdf-canvas" class="pdf-canvas"></canvas>
    <!-- CDN Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/qr-scanner@1.4.2/qr-scanner.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <script>
    // ======================================================================
    // QR Code Scanner Application
    // ======================================================================

    class QRCodeScanner {
        constructor() {
            this.scanner = null;
            this.isScanning = false;
            this.currentCamera = this.getOptimalCameraFacing();
            this.lastScannedCode = null;
            this.lastScanTime = null;

            this.initElements();
            this.initEventListeners();
            this.checkCameraSupport();
            this.initSlider();
        }

        initElements() {
            // UI Elements
            this.cameraBtn = document.getElementById('camera-btn');
            this.fileUploadBtn = document.getElementById('file-upload-btn');
            this.fileInput = document.getElementById('file-input');
            this.photoContent = document.getElementById('photo-content');
            this.photoPlaceholder = document.getElementById('photo-placeholder');
            this.cameraOverlay = document.getElementById('camera-overlay');
            this.video = document.getElementById('qr-video');

            // Camera controls
            this.stopScanBtn = document.getElementById('stop-scan-btn');
            this.cameraLoading = document.getElementById('camera-loading');
            this.uploadLoading = document.getElementById('upload-loading');

            // Result elements
            this.resultSection = document.getElementById('result-section');
            this.resultIcon = document.getElementById('result-icon');
            this.resultText = document.getElementById('result-text');
            this.resultContent = document.getElementById('result-content');
            this.resultData = document.getElementById('result-data');
            this.copyBtn = document.getElementById('copy-btn');
            this.openLinkBtn = document.getElementById('open-link-btn');
            this.clearBtn = document.getElementById('clear-btn');

            // PDF Canvas
            this.pdfCanvas = document.getElementById('pdf-canvas');
        }

        initEventListeners() {
            // Camera button
            this.cameraBtn.addEventListener('click', () => this.toggleCamera());

            // File upload
            this.fileInput.addEventListener('change', (e) => this.handleFileUpload(e));

            // Camera controls
            this.stopScanBtn.addEventListener('click', () => this.stopScanning());

            // Result actions
            this.copyBtn.addEventListener('click', () => this.copyResult());
            this.openLinkBtn.addEventListener('click', () => this.openLink());
            this.clearBtn.addEventListener('click', () => this.clearResult());
        }

        async checkCameraSupport() {
            try {
                if (typeof QrScanner === 'undefined') {
                    throw new Error('QrScanner library not loaded');
                }

                const hasCamera = await QrScanner.hasCamera();
                if (!hasCamera) {
                    this.cameraBtn.classList.add('upload-section--disabled');
                    this.showStatus('Камера недоступна', 'warning');
                }
            } catch (error) {
                console.error('Camera support check error:', error);
                this.cameraBtn.classList.add('upload-section--disabled');
            }
        }

        async toggleCamera() {
            if (!this.video.classList.contains('active')) {
                this.showCamera();
            } else {
                this.hideCamera();
            }
        }

        async showCamera() {
            try {
                this.showLoading();

                // Initialize camera stream
                await this.initScanner();

                // Show camera UI
                this.photoPlaceholder.classList.add('photo-placeholder--hidden');
                this.video.classList.add('active');
                this.cameraOverlay.classList.add('active');
                this.cameraBtn.classList.add('camera-active');

                // Start scanning immediately
                this.isScanning = true;
                this.startJsQRScanning();

                this.hideLoading();
                this.showStatus('Камера активирована. Сканирование активно', 'success');
            } catch (error) {
                this.showStatus('Ошибка доступа к камере: ' + error.message, 'error');
                this.hideLoading();
                this.hideCamera();
            }
        }

        hideCamera() {
            // Stop camera stream
            if (this.video.srcObject) {
                const tracks = this.video.srcObject.getTracks();
                tracks.forEach(track => track.stop());
                this.video.srcObject = null;
            }

            // Hide camera UI
            this.photoPlaceholder.classList.remove('photo-placeholder--hidden');
            this.video.classList.remove('active');
            this.cameraOverlay.classList.remove('active');
            this.cameraBtn.classList.remove('camera-active');

            // Stop scanning
            this.isScanning = false;
            this.updateScanButtons();

            // Clean up scanner resources
            this.scanner = null;
            this.scanCanvas = null;
            this.scanContext = null;
        }

        async initScanner() {
            // Check if jsQR is loaded
            if (typeof jsQR === 'undefined') {
                throw new Error('jsQR library not loaded');
            }

            try {
                // Get camera stream directly
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: this.currentCamera
                    }
                });

                // Bind stream to video element
                this.video.srcObject = stream;
                this.video.play();

                // Create canvas for scanning with jsQR
                this.scanCanvas = document.createElement('canvas');
                this.scanContext = this.scanCanvas.getContext('2d', { willReadFrequently: true });

                // Wait for video to be ready
                await new Promise((resolve) => {
                    this.video.addEventListener('loadedmetadata', () => {
                        resolve();
                    });
                });

                // Camera is ready for scanning

            } catch (error) {
                throw error;
            }
        }

        startJsQRScanning() {
            const scanFrame = () => {
                if (this.isScanning && this.video.readyState === this.video.HAVE_ENOUGH_DATA) {
                    this.scanCanvas.height = this.video.videoHeight;
                    this.scanCanvas.width = this.video.videoWidth;

                    if (this.scanCanvas.width > 0 && this.scanCanvas.height > 0) {
                        this.scanContext.drawImage(this.video, 0, 0, this.scanCanvas.width, this.scanCanvas.height);

                        // First try full image
                        let imageData = this.scanContext.getImageData(0, 0, this.scanCanvas.width, this.scanCanvas.height);
                        let code = jsQR(imageData.data, imageData.width, imageData.height, {
                            inversionAttempts: "tryBoth"
                        });

                        // If not found, try center area
                        if (!code || !code.data || code.data.trim() === '') {
                            const centerSize = Math.min(this.scanCanvas.width, this.scanCanvas.height) * 0.7;
                            const centerX = (this.scanCanvas.width - centerSize) / 2;
                            const centerY = (this.scanCanvas.height - centerSize) / 2;

                            imageData = this.scanContext.getImageData(centerX, centerY, centerSize, centerSize);
                            code = jsQR(imageData.data, imageData.width, imageData.height, {
                                inversionAttempts: "tryBoth"
                            });
                        }

                        // If valid QR code found
                        if (code && code.data && code.data.trim() !== '') {
                            // Check if we haven't scanned this code recently
                            if (this.lastScannedCode !== code.data ||
                                !this.lastScanTime ||
                                Date.now() - this.lastScanTime > 3000) {
                                this.lastScannedCode = code.data;
                                this.lastScanTime = Date.now();
                                this.handleScanResult({ data: code.data });
                            }
                            return;
                        }
                    }
                }

                if (this.isScanning) {
                    requestAnimationFrame(scanFrame);
                }
            };

            requestAnimationFrame(scanFrame);
        }


        stopScanning() {
            // Stop scanning and hide camera completely
            this.hideCamera();
            this.showStatus('Камера остановлена', 'warning');
        }

        getOptimalCameraFacing() {
            // For QR scanning, always use rear/main camera
            // 'environment' - rear camera on mobile, webcam on desktop
            return 'environment';
        }

        updateScanButtons() {
            // No need to update buttons - only stop button exists when camera is active
        }

        handleScanResult(result) {
            const qrData = result.data || result;
            this.showResult(qrData);
            this.showStatus('QR-код успешно распознан!', 'success');

            // Temporary pause before automatic scanning resume
            this.pauseScanningTemporarily();
        }

        pauseScanningTemporarily() {
            this.isScanning = false;
            
            // Automatically resume scanning after 2 seconds
            setTimeout(() => {
                if (this.video.classList.contains('active')) {
                    this.isScanning = true;
                    this.startJsQRScanning();
                }
            }, 2000);
        }

        async handleFileUpload(event) {
            const files = event.target.files;
            if (!files || files.length === 0) return;

            this.showUploadLoading();

            for (const file of files) {
                try {
                    await this.processFile(file);
                } catch (error) {
                    this.showStatus(`Ошибка обработки файла ${file.name}: ${error.message}`, 'error');
                }
            }

            this.hideUploadLoading();
            // Clear the input to allow re-uploading the same file
            event.target.value = '';
        }

        async processFile(file) {
            const fileType = file.type.toLowerCase();
            const fileName = file.name.toLowerCase();

            if (fileType === 'application/pdf' || fileName.endsWith('.pdf')) {
                await this.processPDF(file);
            } else if (fileType.startsWith('image/') || this.isImageFile(fileName)) {
                await this.processImage(file);
            } else {
                throw new Error('Неподдерживаемый тип файла');
            }
        }

        isImageFile(fileName) {
            const imageExtensions = ['.jpg', '.jpeg', '.png', '.bmp', '.webp', '.svg', '.gif'];
            return imageExtensions.some(ext => fileName.endsWith(ext));
        }

        async processImage(file) {
            try {
                // First try with QrScanner
                const result = await QrScanner.scanImage(file);
                this.showResult(result);
                this.showStatus(`QR-код найден в изображении ${file.name}`, 'success');
            } catch (error) {
                // Fallback to jsQR method
                try {
                    const result = await this.scanWithJsQR(file);
                    this.showResult(result);
                    this.showStatus(`QR-код найден в изображении ${file.name}`, 'success');
                } catch (fallbackError) {
                    throw new Error(`QR-код не найден в изображении ${file.name}`);
                }
            }
        }

        async scanWithJsQR(file) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                const objectUrl = URL.createObjectURL(file);

                img.crossOrigin = 'anonymous';
                img.onload = () => {
                    // Clean up object URL
                    URL.revokeObjectURL(objectUrl);

                    try {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');

                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);

                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        const code = jsQR(imageData.data, imageData.width, imageData.height, {
                            inversionAttempts: "tryBoth"
                        });

                        if (code && code.data) {
                            resolve(code.data);
                        } else {
                            reject(new Error('No QR code found'));
                        }
                    } catch (error) {
                        reject(new Error('Failed to process image: ' + error.message));
                    }
                };
                img.onerror = () => {
                    // Clean up object URL on error too
                    URL.revokeObjectURL(objectUrl);
                    reject(new Error('Failed to load image'));
                };
                img.src = objectUrl;
            });
        }

        async processPDF(file) {
            try {
                // Configure PDF.js worker
                pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;

                let qrFound = false;

                // Scan each page of the PDF
                for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                    try {
                        const page = await pdf.getPage(pageNum);
                        const canvas = await this.renderPDFPage(page);

                        // Try to scan QR code from the rendered canvas
                        try {
                            const result = await QrScanner.scanImage(canvas, { returnDetailedScanResult: true });
                            this.showResult(result.data);
                            this.showStatus(`QR-код найден на странице ${pageNum} в PDF ${file.name}`, 'success');
                            qrFound = true;
                            break; // Stop after finding the first QR code
                        } catch (scanError) {
                            // Try with jsQR as fallback
                            const ctx = canvas.getContext('2d');
                            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                            const code = jsQR(imageData.data, imageData.width, imageData.height, {
                                inversionAttempts: "tryBoth"
                            });

                            if (code) {
                                this.showResult(code.data);
                                this.showStatus(`QR-код найден на странице ${pageNum} в PDF ${file.name}`, 'success');
                                qrFound = true;
                                break;
                            }
                        }
                    } catch (pageError) {
                        // Continue to next page if no QR code found on this page
                        console.log(`No QR code found on page ${pageNum}`);
                    }
                }

                if (!qrFound) {
                    throw new Error(`QR-код не найден в PDF ${file.name}`);
                }
            } catch (error) {
                throw new Error(`Ошибка обработки PDF: ${error.message}`);
            }
        }

        async renderPDFPage(page) {
            const scale = 2.0; // Higher scale for better QR detection
            const viewport = page.getViewport({ scale });

            const canvas = this.pdfCanvas;
            const context = canvas.getContext('2d');

            canvas.width = viewport.width;
            canvas.height = viewport.height;

            const renderContext = {
                canvasContext: context,
                viewport: viewport
            };

            await page.render(renderContext).promise;
            return canvas;
        }

        showResult(data) {
            this.resultData.textContent = data;
            this.resultText.textContent = 'QR-код распознан:';
            this.resultContent.classList.add('result-content--visible');

            // Check if data is a URL
            this.updateOpenLinkButton(data);
        }

        updateOpenLinkButton(data) {
            const urlPattern = /^(https?:\/\/|www\.)/i;
            if (urlPattern.test(data)) {
                this.openLinkBtn.style.display = 'block';
                this.openLinkBtn.onclick = () => {
                    const url = data.startsWith('http') ? data : 'https://' + data;
                    window.open(url, '_blank');
                };
            } else {
                this.openLinkBtn.style.display = 'none';
            }
        }

        async copyResult() {
            try {
                await navigator.clipboard.writeText(this.resultData.textContent);
                this.showStatus('Результат скопирован в буфер обмена', 'success');
            } catch (error) {
                this.showStatus('Ошибка копирования в буфер обмена', 'error');
            }
        }

        openLink() {
            const data = this.resultData.textContent;
            const url = data.startsWith('http') ? data : 'https://' + data;
            window.open(url, '_blank');
        }

        clearResult() {
            this.resultContent.classList.remove('result-content--visible');
            this.resultText.textContent = 'Результат сканирования';
            this.resultData.textContent = '';

            // Reset last scan data to allow rescanning the same code
            this.lastScannedCode = null;
            this.lastScanTime = null;

            // If camera is active and not scanning, automatically resume
            if (this.video.classList.contains('active') && !this.isScanning) {
                this.isScanning = true;
                this.startJsQRScanning();
            }
        }

        showLoading() {
            this.cameraLoading.classList.add('loading--visible');
        }

        hideLoading() {
            this.cameraLoading.classList.remove('loading--visible');
        }

        showUploadLoading() {
            this.uploadLoading.classList.add('loading--visible');
        }

        hideUploadLoading() {
            this.uploadLoading.classList.remove('loading--visible');
        }


        showStatus(message, type = 'success') {
            // Remove existing status messages
            const existingMessages = document.querySelectorAll('.status-message');
            existingMessages.forEach(msg => msg.remove());

            const statusDiv = document.createElement('div');
            statusDiv.className = `status-message status-message--${type}`;
            statusDiv.textContent = message;

            document.body.appendChild(statusDiv);

            // Trigger animation
            setTimeout(() => {
                statusDiv.classList.add('status-message--visible');
            }, 10);

            // Auto remove after 3 seconds
            setTimeout(() => {
                statusDiv.classList.remove('status-message--visible');
                setTimeout(() => statusDiv.remove(), 300);
            }, 3000);
        }

        // Slider functionality (keeping the original design)
        initSlider() {
            const buttons = document.querySelectorAll('.switcher-btn');
            const slider = document.querySelector('.switcher-slider');
            const activeClass = 'switcher-btn--active';

            function moveSlider(btn) {
                slider.style.width = `${btn.offsetWidth}px`;
                slider.style.transform = `translateX(${btn.offsetLeft}px)`;
            }

            // Position the slider under the active button on load
            moveSlider(document.querySelector(`.${activeClass}`));

            // Handle clicks
            buttons.forEach(btn => btn.addEventListener('click', () => {
                buttons.forEach(b => b.classList.remove(activeClass));
                btn.classList.add(activeClass);
                moveSlider(btn);

                // For now, only scanner is implemented
                if (btn.dataset.tab === 'generator') {
                    this.showStatus('Генератор QR-кодов будет добавлен в следующем обновлении', 'warning');
                }
            }));
        }

        destroy() {
            if (this.scanner) {
                this.scanner.destroy();
                this.scanner = null;
            }
        }
    }

    // Wait for all libraries to load
    function waitForLibraries() {
        return new Promise((resolve) => {
            const checkLibraries = () => {
                if (typeof QrScanner !== 'undefined' && typeof jsQR !== 'undefined' && typeof pdfjsLib !== 'undefined') {
                    resolve();
                } else {
                    setTimeout(checkLibraries, 100);
                }
            };
            checkLibraries();
        });
    }

    // Initialize the application when DOM and libraries are loaded
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            await waitForLibraries();
            const qrApp = new QRCodeScanner();

            // Cleanup on page unload
            window.addEventListener('beforeunload', () => {
                qrApp.destroy();
            });
        } catch (error) {
            document.body.innerHTML = '<div style="padding: 20px; text-align: center; color: red;">Ошибка загрузки приложения. Попробуйте обновить страницу.</div>';
        }
    });
    </script>
</body>

</html>
